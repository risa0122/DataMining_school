---
title: "df2015na EDA"
output: 
  html_document:
    fig_width: 7
    fig_height: 5
    fig_caption: true
    theme: yeti
    highlight: kate
    toc: true
    toc_float: true
    toc_depth: 3
    #number_sections: true
    #df_print: paged
    #code_folding: show
---

<!--
탐색: tidyverse, ggplot 연습용 
file:///D:/000/20R/ggplot2/ggplot2-birthwt.html
-->

# 자료설명 
* Size Korea 2015년 인체계측자료 일부: n=300 (nc=269), d=13

변수|설명          
----|------------
gnd | 성별{F, M}. 이진 판별분석시 타겟  
age | 나이 
ht  | 키 (cm). 회귀분석시 타겟
wt  | 몸무게 (kg)
wa  | 허리둘레(cm) 
hdln| 손길이(cm)
hdwd| 손너비(cm)
ftln| 발길이(cm)
ftwd| 발너비(cm)
bld | 혈액형{A,AB,B,O}
lft | 왼손잡이용 가변수 (1,0) 
smk | 흡연 여부 (1,0)
alc | 음주 여부 (1,0)

* [Model Lookup](https://topepo.github.io/caret/available-models.html)
* install.packages("caret", dependencies = c("Depends", "Suggests"))

## 참고 사이트: 
* [RStudio Cheat Sheets](https://rstudio.com/resources/cheatsheets/): 최신 치트시트 
* [Data Visualization Cheat Sheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)
* [Data Transformation Cheat Sheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)
* [ggplot2 사이트](http://docs.ggplot2.org/current/)



# 패키지 

```{r}
suppressWarnings(suppressMessages(library(tidyverse)))
library(gridExtra) # grid.arrange(, nrow, ncol)
library(scales)    # scale_x_xxx
library(naniar)
```

# 읽기

```{r}
# as.data.frame으로 안바꾸면 caret vs tidyverse 호환문제 때문에 많은 경고문 발생 
# as.data.frame 해도 문자변수를 factor화 하지 않음 
DF <- as.data.frame(read_csv('/Users/jongeun/Documents/data_mining/df2015na.csv'))
dim(DF)
sapply(DF, class)
head(DF)
```

# 결측
* 결측 현황: naniar

```{r}
# 변수별 결측비율, Missing=결측셀비율, Present=비결측셀비율 
naniar::vis_miss(DF) 
naniar::miss_var_summary(DF)

# 비결측셀 비율 = 비결측셀 수/셀수 = n. 셀수= n*d 
100*sum(!is.na(DF))/(nrow(DF)*ncol(DF)) 
100*n_complete(DF)/(nrow(DF)*ncol(DF))  
100*prop_complete(DF)

# 결측셀 비율 = 결측셀/셀수
100*sum(is.na(DF))/(nrow(DF)*ncol(DF))  # 결측비율 
100*n_miss(DF)/(nrow(DF)*ncol(DF))      # 결측비율 
100*prop_miss(DF)

# 완전한 관측값 비율=완전한 관측값/n
sum(complete.cases(DF))/nrow(DF)*100  # prop_complete_case(DF)
```

* 결측 현황(표본추출): 원자료가 많으면 랜덤 추출해서 파악 권장 

```{r}
DF %>% sample_n(200) %>% vis_miss()
DF %>% sample_n(200) %>% miss_var_summary()
```

# 전처리 
* 문자변수(gnd, 를 factor화
* {0,1}로 코딩 가변수는 그대로 숫자형으로 사용. factor화해도 무방 

```{r}
# factor로 다 바꿀 것. lm, rpart, rf은 안해도 무방, gbm에서 오류남
DF <- mutate(DF, gnd=factor(gnd), bld=factor(bld))
sapply(DF, class)
```
* 참고: 가변수코딩된 이진변수
    * 일반적으로 R에서는 문제 안됨.
    
```
# 1단계: 모든 명목형 변수는 factor화
DF2 <- mutate(DF, gnd=factor(gnd), bld=factor(bld),        
                 lft=factor(lft), smk=factor(smk), alc=factor(alc))
# 2단계: 수준이 숫자인 factor의 수준이 문자가 되도록 수정: {0,1} => {X0, X1} 
DF2 <- mutate(DF2, lft=factor(lft, labels=c('X0','X1')),
                   smk=factor(smk, labels=make.names(levels(smk))),
                   alc=factor(alc, labels=make.names(levels(alc))))
```


# 탐색 
## 단변량 탐색 

```{r}
summary(DF)
# summarize_if(.tbl, .predicate:logical, .funs:list, ...)
# summarize_at(,tbl, .vars:vector. .funs:list, ...)
summarize_if(DF, is.numeric, list(mn=mean, sd=sd), na.rm=TRUE)
summarize_at(DF, c('ht','wt'), list(mn=mean, sd=sd), na.rm=TRUE)
```

```{r}
g1 <- ggplot(DF, aes(x=ht)) + geom_density() + geom_rug()
g2 <- ggplot(DF, aes(x=ht)) + geom_histogram(color='black', fill='white')

g3 <- ggplot(DF, aes(x=ht)) + 
       geom_histogram(aes(y=..density..), color='black', fill='white') +
       geom_density(alpha=0.2, fill='#FF6666') + 
       geom_rug()
g4 <- ggplot(DF, aes(x=ht)) + geom_boxplot() 
grid.arrange(g1, g2, g3, g4, nrow=2, ncol=2)

g1 <- ggplot(DF, aes(x=gnd)) + geom_bar()
g2 <- ggplot(DF, aes(x=gnd)) + 
        geom_bar(aes(y=..count../sum(..count..))) +
        scale_y_continuous(labels=percent)
g3 <- ggplot(DF, aes(x=smk)) + geom_bar()
g4 <- ggplot(DF, aes(x=smk)) + 
        geom_bar(aes(y=..count../sum(..count..))) +
        scale_y_continuous(labels=percent)
grid.arrange(g1, g2, g3, g4, nrow=2, ncol=2)
```


## 이변량 탐색
###  연속 ~ 이산 

```{r}
DF %>% 
  group_by(gnd) %>% 
  summarize_at(c('ht','wt'), list(mn=mean, sd=sd), na.rm=TRUE)

DF %>% 
  group_by(gnd) %>% 
  summarize_if(is.numeric, list(mn=mean, sd=sd), na.rm=TRUE)
#[이 노래가 어디 나오는 노래인지 맞춰 볼 것, 가사도 구해서 구글번역할 것. 선착순 3명](https://www.youtube.com/watch?v=KH71jKtljPE)


g1 <- ggplot(DF, aes(x=ht, col=gnd, fill=gnd)) + geom_density(alpha=0.5)
g2 <- ggplot(DF, aes(x=ht, col=gnd, fill=gnd)) + geom_histogram(alpha=0.5)
g3 <- ggplot(DF, aes(x=ht)) + geom_histogram() + facet_grid(gnd~.)
g4 <- ggplot(DF, aes(x=gnd, y=ht)) + geom_boxplot() + coord_flip()
grid.arrange(g1, g2, g3, g4, nrow=2, ncol=2)
```



```{r}
t.test(ht~gnd, data=DF, var.equal=TRUE)
summary(aov(ht~bld, data=DF))
```

###  연속 ~ 연속

```{r}
R <- cor(DF[,sapply(DF, is.numeric)], use='pairwise.complete.obs')
R
sort(R['ht',], decreasing=TRUE)

g1 <- ggplot(DF, aes(x=ftln, y=ht)) + geom_point(alpha=0.5)
g2 <- ggplot(DF, aes(x=ftln, y=ht, color=gnd, shape=gnd)) + geom_point(alpha=0.5)
g3 <- ggplot(DF, aes(x=smk, y=ht, color=gnd, shape=gnd)) + geom_point(alpha=0.5)
g4 <- ggplot(DF, aes(x=smk, y=ht, color=gnd, shape=gnd)) + geom_jitter(alpha=0.5)
grid.arrange(g1, g2, g3, g4, nrow=2, ncol=2)

library(GGally) # ggcorr, ggparis
ggcorr(DF[,sapply(DF, is.numeric)], 
       geom = 'tile',                # nbreaks=9, palette='RdYlGn',
       label=TRUE)

ggpairs(DF, 
        columns=c('ht','ftln','hdln','ftwd','hdwd', 'wt'),
        lower=list(continuous=wrap('points', alpha=0.05, col='blue')),
        diag=list(continuous='barDiag'))   # diag=list(continous='densityDiag')

ggplot(DF, aes(x=wt, y=ht))+ geom_density2d() + geom_point(aes(col=gnd, shape=gnd))
```
             
### 이산 ~ 이산

```{r}
g1 <- ggplot(DF, aes(x=smk, fill=gnd)) + geom_bar()
g2 <- ggplot(DF, aes(x=smk, fill=gnd)) + geom_bar(aes(y=..count../sum(..count..)))

# Or
tb <- table(DF$gnd, DF$smk)
tb <- xtabs(~smk+gnd, data=DF)
df <- data.frame(tb)
df
g3 <- ggplot(df, aes(x=gnd, y=Freq)) + geom_bar(aes(fill=smk), stat='identity')


tb <- prop.table(xtabs(~gnd+smk, data=DF),1)
tb
df <- data.frame(tb)
df
g4 <- ggplot(df, aes(x=gnd, y=Freq)) + geom_bar(aes(fill=smk), stat='identity')

grid.arrange(g1, g2, g3, g4, nrow=2, ncol=2)
```

```
chisq.test(xtabs(~gnd+smk, data=DF), correct=FALSE)
```




















